# -*- coding: utf-8 -*-

import os
import re

def cwd_compact():
  '''Return the current working directory.

  Returns a segment list to create a breadcrumb-like effect.

  :param int dir_shorten_len:
    shorten parent directory names to this length (e.g. :file:`/long/path/to/powerline` → :file:`/l/p/t/powerline`)
  :param int dir_limit_depth:
    limit directory depth to this number (e.g. :file:`/long/path/to/powerline` → :file:`⋯/to/powerline`)
  '''
  try:
    try:
      cwd = os.getcwdu()
    except AttributeError:
      cwd = os.getcwd()
  except OSError as e:
    if e.errno == 2:
      # user most probably deleted the directory
      # this happens when removing files from Mercurial repos for example
      cwd = "[not found]"
    else:
      raise
  home = os.environ.get('HOME')
  if home:
    cwd = re.sub('^' + re.escape(home), '~', cwd, 1)
  return cwd
